{"version":3,"sources":["file:///Users/mac/Desktop/222/testProject/assets/scripts/UIButton.ts"],"names":["_decorator","Component","Button","Sprite","Tween","tween","v3","ccclass","property","menu","EventType","UIButton","tooltip","visible","longTouch","combo","lastTime","startFunc","endFunc","_func","call","_onTouchBegan","event","stopAllByTarget","node","EventHandler","emitEvents","clickEvents","schedule","longTouchInterval","_onTouchEnded","_interactable","enabledInHierarchy","to","scale","easing","union","repeatForever","start","_pressed","now","Date","delta","damping","console","log","emit","CLICK","unschedule","_updateState","propagationStopped","_onTouchCancel","grayScale","value","iconSpr","getComponent","getComponentInChildren","grayscale","interactable","_resetState","clickAudio"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, EventTouch, EventHandler, Button, Sprite, AudioSource, Tween, tween, v3 } from 'cc';\nconst { ccclass, property, menu } = _decorator;\n\nenum EventType {\n    /**\n     * @event click\n     * @param {Event.EventCustom} event\n     * @param {Button} button - The Button component.\n     */\n    CLICK = 'click'\n}\n\n@ccclass\n@menu('core/UIButton')\nexport default class UIButton extends Button {\n    @property({ tooltip: '是否可以连点' })\n    private combo = true;\n\n    @property({ tooltip: '是否支持长按' })\n    private longTouch: boolean = false;\n\n    @property({\n        tooltip: '长按间隔时间',\n        visible: function (this: UIButton) {\n            return this.longTouch;\n        }\n    })\n    private longTouchInterval: number = 0.2;\n\n    @property({\n        tooltip: '连点间隔时间(毫秒)',\n        visible: function (this: UIButton) {\n            return !this.combo;\n        }\n    })\n    private damping: number = 300;\n\n    private lastTime: number = 0;\n    private startFunc: Function | null = null;\n    private endFunc: Function | null = null;\n\n    public static clickAudio: string; // 点击音效\n    private _func = null;\n\n    /**\n     * 添加回调函数 btn.call(()=>{});`\n     * @param startFunc 触摸开始后的回调函数\n     * @param endFunc 触摸结束后的回调函数\n     * */\n    public call(startFunc: (target?: Node) => void, endFunc?: (target?: Node) => void): void {\n        this.startFunc = startFunc;\n        this.endFunc = endFunc;\n    }\n\n    protected _onTouchBegan(event: EventTouch): void {\n        Tween.stopAllByTarget(this.node);\n        super._onTouchBegan(event);\n        this.startFunc && this.startFunc(this.node);\n\n        this._func = () => {\n            Component.EventHandler.emitEvents(this.clickEvents, event);\n        };\n        if (this.longTouch) {\n            this.schedule(this._func, this.longTouchInterval);\n        }\n    }\n\n    protected _onTouchEnded(event: EventTouch): void {\n        if (!this._interactable || !this.enabledInHierarchy) {\n            return;\n        }\n\n        tween(this.node).to(0.6, { scale: v3(1.1, 1.0, 1) }, { easing: 'sineInOut' })\n            .to(0.6, { scale: v3(1.0, 1, 1) }, { easing: 'sineInOut' })\n            .union()\n            .repeatForever()\n            .start();\n\n        if (this._pressed) {\n            let now = Date.now();\n            const delta = now - this.lastTime;\n            if (!this.combo && delta < this.damping) {\n                console.log('%c屏蔽快速点击_onTouchBegan', 'color:red');\n            } else {\n                this.lastTime = now;\n                Component.EventHandler.emitEvents(this.clickEvents, event);\n                this.node.emit(EventType.CLICK, this);\n                this.endFunc && this.endFunc(this.node);\n            }\n            // 回调函数\n\n            if (this.longTouch && this._func) {\n                this.unschedule(this._func);\n                this._func = null;\n            }\n        }\n\n        this._pressed = false;\n        this._updateState();\n\n        if (event) {\n            event.propagationStopped = true;\n        }\n    }\n\n    protected _onTouchCancel(event: EventTouch): void {\n        super._onTouchCancel(event);\n        // 回调函数\n        this.endFunc && this.endFunc(this.node);\n\n        if (this.longTouch && this._func) {\n            this.unschedule(this._func);\n            this._func = null;\n        }\n    }\n\n    // 仅置灰\n    set grayScale(value: boolean) {\n        const iconSpr = this.node.getComponent(Sprite) || this.node.getComponentInChildren(Sprite);\n        if (iconSpr) {\n            iconSpr.grayscale = value;\n        }\n    }\n\n    // 可交互状态\n    set interactable(value: boolean) {\n        const iconSpr = this.node.getComponentInChildren(Sprite);\n        if (iconSpr) {\n            iconSpr.grayscale = !value;\n        }\n        if (this._interactable === value) {\n            return;\n        }\n\n        this._interactable = value;\n        this._updateState();\n\n        if (!this._interactable) {\n            this._resetState();\n        }\n    }\n}\n"]}